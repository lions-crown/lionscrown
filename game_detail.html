<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Detail</title>

<style>
body{margin:0;background:#0b1d3a;color:#fff;font-family:sans-serif;}
.section{padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);}
.flex{display:flex;gap:20px;flex-wrap:wrap;}
.panel{background:rgba(255,255,255,0.06);padding:15px;border-radius:16px;}
button{background:#1f6feb;border:none;color:#fff;padding:6px 12px;border-radius:8px;cursor:pointer;}
input,select{margin:4px 0;}
canvas{background:#111;border-radius:12px;}
.result-card{background:rgba(255,255,255,0.07);padding:8px;margin:6px 0;border-radius:10px;}
</style>
</head>
<body>

<!-- ğŸ”´ é€Ÿå ± -->
<div class="section panel">
<h2>ä¸€çƒé€Ÿå ±</h2>
<div id="scoreboard"></div>
<div id="liveDetail"></div>
<canvas id="zoneCanvas" width="250" height="250"></canvas>
</div>

<!-- ğŸ”µ ãƒŠãƒ“ -->
<div class="section panel">
<button onclick="prevAtBat()">å‰ã¸</button>
<button onclick="nextAtBat()">æ¬¡ã¸</button>
</div>

<!-- ğŸŸ¢ æ¤œç´¢ -->
<div class="section panel">
<h3>çŠ¶æ³åˆ¥æ¤œç´¢</h3>

<select id="countFilter">
<option value="">ã‚«ã‚¦ãƒ³ãƒˆ</option>
<option value="0-0">0-0</option>
<option value="1-1">1-1</option>
<option value="2-2">2-2</option>
</select>

<select id="baseFilter">
<option value="">å¡çŠ¶æ³</option>
<option value="100">ä¸€å¡</option>
<option value="110">ä¸€äºŒå¡</option>
<option value="000">ãªã—</option>
</select>

<select id="handFilter">
<option value="">å¯¾å·¦å³</option>
<option value="L">å¯¾å·¦</option>
<option value="R">å¯¾å³</option>
</select>

<select id="pitchTypeFilter">
<option value="">çƒç¨®</option>
<option value="FF">FF</option>
<option value="SL">SL</option>
</select>

<button onclick="search()">æ¤œç´¢</button>

<div id="searchResults"></div>
</div>

<!-- ğŸŸ£ çµ±è¨ˆ -->
<div class="section flex">

<div class="panel">
<h3>çƒç¨®å‰²åˆ</h3>
<canvas id="pitchChart" width="250" height="250"></canvas>
</div>

<div class="panel">
<h3>æ‰“çƒãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</h3>
<canvas id="hitMap" width="300" height="300"></canvas>
</div>

</div>

<script>
let data
let currentIndex=0

fetch("live/2026-03-01_1.json")
.then(r=>r.json())
.then(d=>{
  data=d
  renderLive()
  renderCharts()
})

function renderLive(){
  const ev=data.events[currentIndex]
  document.getElementById("scoreboard").innerHTML=
    `${ev.inning}å› ${ev.half} / ${ev.stateStart.score.L}-${ev.stateStart.score.H}`

  document.getElementById("liveDetail").innerHTML=
    `æ‰“è€…:${ev.batter.name} vs æŠ•æ‰‹:${ev.pitcher.name}<br>
     çµæœ:${ev.result.type}`

  drawZone(ev)
}

function drawZone(ev){
  const c=document.getElementById("zoneCanvas")
  const ctx=c.getContext("2d")
  ctx.clearRect(0,0,250,250)
  ctx.strokeStyle="white"
  ctx.strokeRect(75,50,100,150)

  ev.pitches.forEach(p=>{
    ctx.fillStyle = p.type==="FF"?"red":"blue"
    ctx.beginPath()
    ctx.arc(125+p.zone.x*80,125-p.zone.y*80,5,0,2*Math.PI)
    ctx.fill()
  })
}

function prevAtBat(){
  if(currentIndex>0){currentIndex--;renderLive()}
}
function nextAtBat(){
  if(currentIndex<data.events.length-1){currentIndex++;renderLive()}
}

function search(){
  const count=document.getElementById("countFilter").value
  const base=document.getElementById("baseFilter").value
  const hand=document.getElementById("handFilter").value
  const pitchType=document.getElementById("pitchTypeFilter").value

  const results=data.events.filter(ev=>{
    if(hand && ev.batter.hand!==hand) return false
    if(base && ev.stateStart.bases.join("")!==base) return false
    if(pitchType && !ev.pitches.some(p=>p.type===pitchType)) return false
    if(count && !ev.pitches.some(p=>p.count===count)) return false
    return true
  })

  const box=document.getElementById("searchResults")
  box.innerHTML=""
  results.forEach(ev=>{
    box.innerHTML+=`
      <div class="result-card">
      ${ev.inning}å› ${ev.batter.name} ${ev.result.type}
      </div>`
  })
}

function renderCharts(){
  const pitches=[]
  data.events.forEach(ev=>pitches.push(...ev.pitches))

  const typeCount={}
  pitches.forEach(p=>{
    typeCount[p.type]=(typeCount[p.type]||0)+1
  })

  const ctx=document.getElementById("pitchChart").getContext("2d")
  const total=pitches.length
  let start=0
  Object.keys(typeCount).forEach((t,i)=>{
    const slice=typeCount[t]/total*2*Math.PI
    ctx.fillStyle=["red","blue","green","purple"][i%4]
    ctx.beginPath()
    ctx.moveTo(125,125)
    ctx.arc(125,125,100,start,start+slice)
    ctx.fill()
    start+=slice
  })

  drawHitMap()
}

function drawHitMap(){
  const c=document.getElementById("hitMap")
  const ctx=c.getContext("2d")
  ctx.clearRect(0,0,300,300)
  ctx.fillStyle="white"
  ctx.beginPath()
  ctx.arc(150,150,100,0,Math.PI)
  ctx.stroke()

  data.events.forEach(ev=>{
    ev.pitches.forEach(p=>{
      if(p.exitVelocity){
        ctx.fillStyle="yellow"
        ctx.beginPath()
        ctx.arc(150+p.sprayAngle,150-p.launchAngle,4,0,2*Math.PI)
        ctx.fill()
      }
    })
  })
}
</script>

</body>
</html>
