<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>埼玉西武ライオンズ 選手名鑑</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.0/nouislider.min.css" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: "Segoe UI", "Noto Sans JP", sans-serif;
    background: linear-gradient(135deg, #091b3d, #0d2b5e);
    color: #fff;
  }
  h1 { 
    text-align: center; 
    margin: 16px 0 24px; 
    font-size: 2.4em; 
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    align-items: flex-end;
    margin-bottom: 24px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }
  .controls > * {
    min-width: 160px;
  }
  .controls select, .controls input {
    padding: 10px 14px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    background: #0f254e;
    color: white;
  }
  .controls select[multiple] {
    width: 160px;
    height: 140px;
  }
  .search-container {
    position: relative;
    flex: 1;
    min-width: 240px;
    max-width: 400px;
  }
  .range-sliders {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    justify-content: center;
    margin-bottom: 24px;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }
  .range-slider {
    flex: 1;
    min-width: 240px;
    max-width: 320px;
  }
  .sort-controls {
    text-align: center;
    margin-bottom: 24px;
  }
  .sort-controls select {
    padding: 10px 16px;
    font-size: 16px;
    border-radius: 6px;
    background: #0f254e;
    color: white;
    border: none;
  }
  .player-grid {
    display: grid;
    gap: 20px;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    max-width: 1400px;
    margin: 0 auto;
  }
  .player-card {
    display: flex;
    background: rgba(10, 25, 60, 0.92);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    transition: all 0.25s ease;
  }
  .player-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 14px 28px rgba(0,0,0,0.65);
  }
  .player-photo img {
    width: 120px;
    height: 120px;
    object-fit: cover;
  }
  .player-info {
    flex: 1;
    padding: 14px 18px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    font-size: 1.15em;
  }
  .position {
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 0.85em;
    color: #000;
  }
  .position-投手 { background: #1E90FF; }
  .position-捕手 { background: #FF4500; }
  .position-内野手 { background: #32CD32; }
  .position-外野手 { background: #FFD700; }
  .middle a {
    color: #fff;
    text-decoration: none;
    font-size: 1.15em;
  }
  .middle a:hover { text-decoration: underline; }
  .bottom {
    display: flex;
    justify-content: space-between;
    font-size: 0.9em;
    color: #ddd;
  }
  .autocomplete-items {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #0a193c;
    border: 1px solid #1E90FF;
    max-height: 220px;
    overflow-y: auto;
    border-radius: 6px;
    z-index: 100;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  .autocomplete-items div {
    padding: 10px 14px;
    cursor: pointer;
  }
  .autocomplete-items div:hover {
    background: #1E90FF;
  }
  .range-slider .slider-label {
    font-size: 0.95em;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
  }
  .range-slider .slider-inputs {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    gap: 10px;
  }
  .range-slider .slider-inputs input {
    flex: 1;
    padding: 8px;
    border-radius: 4px;
    border: none;
    font-size: 0.95em;
    background: #0f254e;
    color: white;
    text-align: center;
  }
</style>
</head>
<body>

<h1>埼玉西武ライオンズ 選手名鑑</h1>

<div class="controls">
  <select id="yearSelect" multiple size="6">
    <!-- JSで埋める -->
  </select>
  <select id="positionFilter">
    <option value="">全ポジション</option>
    <option value="投手">投手</option>
    <option value="捕手">捕手</option>
    <option value="内野手">内野手</option>
    <option value="外野手">外野手</option>
  </select>
  <div class="search-container">
    <input type="text" id="nameSearch" placeholder="選手名で検索…" autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
  </div>
</div>

<div class="range-sliders">
  <div class="range-slider">
    <div class="slider-label">背番号 <span id="numRangeLabel">00 – 145</span></div>
    <div class="slider-inputs">
      <input type="number" id="numStartInput" min="0" max="145" value="0">
      <input type="number" id="numEndInput" min="0" max="145" value="145">
    </div>
    <div id="numSlider"></div>
  </div>
  <div class="range-slider">
    <div class="slider-label">年齢 <span id="ageRangeLabel">17 – 50</span></div>
    <div class="slider-inputs">
      <input type="number" id="ageStartInput" min="17" max="50" value="17">
      <input type="number" id="ageEndInput" min="17" max="50" value="50">
    </div>
    <div id="ageSlider"></div>
  </div>
  <div class="range-slider">
    <div class="slider-label">ドラフト年 <span id="draftRangeLabel">2010 – 2026</span></div>
    <div class="slider-inputs">
      <input type="number" id="draftStartInput" min="2010" max="2026" value="2010">
      <input type="number" id="draftEndInput" min="2010" max="2026" value="2026">
    </div>
    <div id="draftSlider"></div>
  </div>
</div>

<div class="sort-controls">
  <select id="sortSelect">
    <option value="number_asc">背番号 ↑</option>
    <option value="number_desc">背番号 ↓</option>
    <option value="age_asc">年齢 ↑</option>
    <option value="age_desc">年齢 ↓</option>
    <option value="draft_asc">ドラフト年 ↑</option>
    <option value="draft_desc">ドラフト年 ↓</option>
    <option value="name_asc">名前 五十音 ↑</option>
    <option value="name_desc">名前 五十音 ↓</option>
  </select>
</div>

<div class="player-grid" id="playerGrid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.0/nouislider.min.js"></script>
<script>
// データ（実際の運用ではAPIやJSONファイルから取得推奨）
const players = {
  "2026": [
    { number: 11, name: "上田 大河", position: "投手", birth_year: 2002, draft: 2020, photo: "https://via.placeholder.com/120?text=11", link: "#" },
    { number: 18, name: "隅田 知一郎", position: "投手", birth_year: 1999, draft: 2021, photo: "https://via.placeholder.com/120?text=18", link: "#" },
    { number: 0, name: "源田 壮亮", position: "内野手", birth_year: 1994, draft: 2016, photo: "https://via.placeholder.com/120?text=源田", link: "#" },
    { number: 65, name: "古賀 悠斗", position: "捕手", birth_year: 2000, draft: 2018, photo: "https://via.placeholder.com/120?text=65", link: "#" },
    // 実際はもっと多くの選手をここに…（公式サイトなどから取得推奨）
  ],
  "2025": [
    // 同様に…
  ]
  // 他の年も必要に応じて
};

function displayNumber(n) {
  return n < 10 ? "0" + n : n;
}

function getSelectedYears() {
  return [...document.getElementById("yearSelect").selectedOptions].map(o => o.value);
}

function collectPlayers() {
  const years = getSelectedYears();
  if (years.length === 0) return [];
  
  let all = [];
  years.forEach(year => {
    if (players[year]) {
      players[year].forEach(p => all.push({ ...p, ref_year: parseInt(year) }));
    }
  });
  
  // 最新年のデータを優先
  const map = new Map();
  all.sort((a,b) => b.ref_year - a.ref_year);
  all.forEach(p => {
    if (!map.has(p.name)) map.set(p.name, p);
  });
  return Array.from(map.values());
}

// スライダー作成関数（変更なし）
function createSlider(id, min, max, start, labelId, startInputId, endInputId) {
  const slider = document.getElementById(id);
  const startInput = document.getElementById(startInputId);
  const endInput = document.getElementById(endInputId);
  const label = document.getElementById(labelId);

  noUiSlider.create(slider, {
    start: start,
    connect: true,
    step: 1,
    range: { min, max },
    format: { to: v => Math.round(v), from: v => Number(v) }
  });

  const updateUI = (values) => {
    const [s, e] = values.map(v => Math.round(v));
    label.textContent = `${displayNumber(s)} – ${displayNumber(e)}`;
    startInput.value = s;
    endInput.value = e;
  };

  slider.noUiSlider.on("update", updateUI);

  const syncFromInputs = () => {
    let s = parseInt(startInput.value) || min;
    let e = parseInt(endInput.value) || max;
    if (s > e) [s, e] = [e, s];
    s = Math.max(min, Math.min(max, s));
    e = Math.max(min, Math.min(max, e));
    slider.noUiSlider.set([s, e]);
  };

  startInput.addEventListener("input", syncFromInputs);
  endInput.addEventListener("input", syncFromInputs);
}

createSlider("numSlider", 0, 145, [0, 145], "numRangeLabel", "numStartInput", "numEndInput");
createSlider("ageSlider", 17, 50, [17, 50], "ageRangeLabel", "ageStartInput", "ageEndInput");
createSlider("draftSlider", 2010, 2026, [2010, 2026], "draftRangeLabel", "draftStartInput", "draftEndInput");

// デバウンス関数（検索の快適さ向上）
function debounce(fn, delay) {
  let timer;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...args), delay);
  };
}

// オートコンプリート & 検索（デバウンス適用）
const nameInput = document.getElementById("nameSearch");
const autoList = document.getElementById("autocomplete-list");

const debouncedRender = debounce(renderPlayers, 300);

nameInput.addEventListener("input", () => {
  const val = nameInput.value.trim();
  autoList.innerHTML = "";
  
  if (val.length >= 1) {
    const list = collectPlayers()
      .filter(p => p.name.includes(val))
      .slice(0, 10);
    
    list.forEach(p => {
      const div = document.createElement("div");
      div.textContent = `${p.name} (${displayNumber(p.number)})`;
      div.addEventListener("click", () => {
        nameInput.value = p.name;
        autoList.innerHTML = "";
        renderPlayers();
      });
      autoList.appendChild(div);
    });
  }
  
  debouncedRender();   // ← ここで遅延実行
});

document.addEventListener("click", e => {
  if (e.target !== nameInput) autoList.innerHTML = "";
});

// 選手描画関数（変更なし・省略可）
function renderPlayers() {
  let arr = collectPlayers();

  const pos = document.getElementById("positionFilter").value;
  if (pos) arr = arr.filter(p => p.position === pos);

  const name = nameInput.value.trim();
  if (name) arr = arr.filter(p => p.name.includes(name));

  const numS = parseInt(document.getElementById("numStartInput").value) || 0;
  const numE = parseInt(document.getElementById("numEndInput").value) || 145;
  arr = arr.filter(p => p.number >= numS && p.number <= numE);

  const ageS = parseInt(document.getElementById("ageStartInput").value) || 17;
  const ageE = parseInt(document.getElementById("ageEndInput").value) || 50;
  arr = arr.filter(p => {
    const age = p.ref_year - p.birth_year;
    return age >= ageS && age <= ageE;
  });

  const draftS = parseInt(document.getElementById("draftStartInput").value) || 2010;
  const draftE = parseInt(document.getElementById("draftEndInput").value) || 2026;
  arr = arr.filter(p => p.draft >= draftS && p.draft <= draftE);

  const sort = document.getElementById("sortSelect").value;
  arr.sort((a, b) => {
    const ageA = a.ref_year - a.birth_year;
    const ageB = b.ref_year - b.birth_year;
    switch (sort) {
      case "number_asc": return a.number - b.number;
      case "number_desc": return b.number - a.number;
      case "age_asc": return ageA - ageB;
      case "age_desc": return ageB - ageA;
      case "draft_asc": return a.draft - b.draft;
      case "draft_desc": return b.draft - a.draft;
      case "name_asc": return a.name.localeCompare(b.name, "ja");
      case "name_desc": return b.name.localeCompare(a.name, "ja");
      default: return 0;
    }
  });

  const grid = document.getElementById("playerGrid");
  grid.innerHTML = "";

  if (arr.length === 0) {
    grid.innerHTML = '<p style="text-align:center; grid-column:1/-1; padding:60px 20px;">該当する選手が見つかりませんでした</p>';
    return;
  }

  arr.forEach(p => {
    const age = p.ref_year - p.birth_year;
    const card = document.createElement("div");
    card.className = "player-card";
    card.innerHTML = `
      <div class="player-photo"><img src="${p.photo}" alt="${p.name}"></div>
      <div class="player-info">
        <div class="top">
          <span>${displayNumber(p.number)}</span>
          <span class="position position-${p.position}">${p.position}</span>
        </div>
        <div class="middle"><a href="${p.link}">${p.name}</a></div>
        <div class="bottom">
          <span>ドラフト ${p.draft}</span>
          <span>${age}歳 (${p.ref_year}年基準)</span>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

// 初期化
const yearSelect = document.getElementById("yearSelect");
for (let y = 2026; y >= 2015; y--) {
  const opt = document.createElement("option");
  opt.value = y;
  opt.textContent = y + "年";
  if (y === 2026 || y === 2025) opt.selected = true;
  yearSelect.appendChild(opt);
}

["yearSelect", "positionFilter", "sortSelect"].forEach(id => {
  document.getElementById(id).addEventListener("change", renderPlayers);
});

// 初回描画
renderPlayers();
</script>
</body>
</html>
