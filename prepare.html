<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>埼玉西武ライオンズ 選手名鑑</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.0/nouislider.min.css" rel="stylesheet">
<style>
  /* 以前のスタイルをそのまま使用（変更なしで省略） */
  /* ... あなたの元のスタイル全文をここに貼り付けてください ... */
  /* 必要に応じて .range-slider .noUi-connect { background: #1E90FF; } などでスライダー色を調整可能 */
</style>
</head>
<body>

<h1>埼玉西武ライオンズ 選手名鑑</h1>

<div class="controls">
  <select id="yearSelect" multiple size="6"></select>
  <select id="positionFilter">
    <option value="">全ポジション</option>
    <option value="投手">投手</option>
    <option value="捕手">捕手</option>
    <option value="内野手">内野手</option>
    <option value="外野手">外野手</option>
  </select>
  <div class="search-container">
    <input type="text" id="nameSearch" placeholder="選手名で検索…" autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
  </div>
</div>

<div class="range-sliders">
  <div class="range-slider">
    <div class="slider-label">背番号 <span id="numRangeLabel">00 – 145</span></div>
    <div class="slider-inputs">
      <input type="number" id="numStartInput" min="0" max="145" value="0">
      <input type="number" id="numEndInput" min="0" max="145" value="145">
    </div>
    <div id="numSlider"></div>
  </div>

  <div class="range-slider">
    <div class="slider-label">年齢 <span id="ageRangeLabel">17 – 50</span></div>
    <div class="slider-inputs">
      <input type="number" id="ageStartInput" min="17" max="50" value="17">
      <input type="number" id="ageEndInput" min="17" max="50" value="50">
    </div>
    <div id="ageSlider"></div>
  </div>

  <div class="range-slider">
    <div class="slider-label">ドラフト年 <span id="draftRangeLabel">2010 – 2026</span></div>
    <div class="slider-inputs">
      <input type="number" id="draftStartInput" min="2010" max="2026" value="2010">
      <input type="number" id="draftEndInput" min="2010" max="2026" value="2026">
    </div>
    <div id="draftSlider"></div>
  </div>
</div>

<div class="sort-controls">
  <select id="sortSelect">
    <option value="number_asc">背番号 ↑</option>
    <option value="number_desc">背番号 ↓</option>
    <option value="age_asc">年齢 ↑</option>
    <option value="age_desc">年齢 ↓</option>
    <option value="draft_asc">ドラフト年 ↑</option>
    <option value="draft_desc">ドラフト年 ↓</option>
    <option value="name_asc">名前 五十音 ↑</option>
    <option value="name_desc">名前 五十音 ↓</option>
  </select>
</div>

<div class="player-grid" id="playerGrid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.0/nouislider.min.js"></script>
<script>
// データ（2026年現在の公式情報を基に大幅拡張・一部birth_year/draftは参考値）
const players = {
  "2026": [
    // 投手（一部抜粋・実際はもっと多い）
    { number: 11, name: "上田 大河", position: "投手", birth_year: 2001, draft: 2019, photo: "https://via.placeholder.com/120?text=11", link: "#" },
    { number: 16, name: "隅田 知一郎", position: "投手", birth_year: 1999, draft: 2020, photo: "https://via.placeholder.com/120?text=16", link: "#" },
    { number: 13, name: "高橋 光成", position: "投手", birth_year: 1997, draft: 2015, photo: "https://via.placeholder.com/120?text=13", link: "#" },
    { number: 61, name: "平良 海馬", position: "投手", birth_year: 1999, draft: 2018, photo: "https://via.placeholder.com/120?text=61", link: "#" },
    // 捕手
    { number: 22, name: "古賀 悠斗", position: "捕手", birth_year: 2000, draft: 2018, photo: "https://via.placeholder.com/120?text=22", link: "#" },
    { number: 27, name: "炭谷 銀仁朗", position: "捕手", birth_year: 1989, draft: 2006, photo: "https://via.placeholder.com/120?text=27", link: "#" },
    // 内野手
    { number: 0, name: "源田 壮亮", position: "内野手", birth_year: 1994, draft: 2016, photo: "https://via.placeholder.com/120?text=源田", link: "#" },
    { number: 6, name: "源田 壮亮", position: "内野手", birth_year: 1994, draft: 2016, photo: "https://via.placeholder.com/120?text=6", link: "#" }, // 重複例
    { number: 5, name: "外崎 修汰", position: "内野手", birth_year: 1992, draft: 2014, photo: "https://via.placeholder.com/120?text=5", link: "#" },
    // 外野手
    { number: 1, name: "栗山 巧", position: "外野手", birth_year: 1983, draft: 2001, photo: "https://via.placeholder.com/120?text=1", link: "#" },
    { number: 9, name: "蛭間 拓哉", position: "外野手", birth_year: 2000, draft: 2022, photo: "https://via.placeholder.com/120?text=9", link: "#" },
    // さらに多くの選手を追加可能（公式からコピー推奨）
  ],
  // "2025": [...] ← 必要ならここに過去データ
};

function displayNumber(n) {
  return n < 10 ? "0" + n : n;
}

function getSelectedYears() {
  return [...document.getElementById("yearSelect").selectedOptions].map(o => o.value);
}

function collectPlayers() {
  const years = getSelectedYears();
  if (years.length === 0) return [];

  let all = [];
  years.forEach(year => {
    if (players[year]) {
      players[year].forEach(p => all.push({ ...p, ref_year: parseInt(year) }));
    }
  });

  // 名前が同じ選手は最新年を優先
  const map = new Map();
  all.sort((a, b) => b.ref_year - a.ref_year);
  all.forEach(p => {
    if (!map.has(p.name)) map.set(p.name, p);
  });
  return Array.from(map.values());
}

// 共通のデバウンス（スライダーも名前検索も150msで統一 → 体感ほぼリアルタイム）
function debounce(fn, delay = 150) {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...args), delay);
  };
}

const debouncedRender = debounce(renderPlayers);

// スライダー作成（1つの関数に統合）
function createSlider(id, min, max, start, labelId, startInputId, endInputId) {
  const slider = document.getElementById(id);
  const startInput = document.getElementById(startInputId);
  const endInput = document.getElementById(endInputId);
  const label = document.getElementById(labelId);

  noUiSlider.create(slider, {
    start: start,
    connect: true,
    step: 1,
    range: { min, max },
    format: { to: v => Math.round(v), from: v => Number(v) }
  });

  const updateUI = (values) => {
    const [s, e] = values.map(v => Math.round(v));
    label.textContent = `${displayNumber(s)} – ${displayNumber(e)}`;
    startInput.value = s;
    endInput.value = e;
  };

  // ドラッグ中（slide）で即時反映
  slider.noUiSlider.on("slide", (values) => {
    updateUI(values);
    debouncedRender();
  });

  // 確定時（update）でも
  slider.noUiSlider.on("update", (values) => {
    updateUI(values);
    debouncedRender();
  });

  const syncFromInputs = () => {
    let s = parseInt(startInput.value) || min;
    let e = parseInt(endInput.value) || max;
    if (s > e) [s, e] = [e, s];
    s = Math.max(min, Math.min(max, s));
    e = Math.max(min, Math.min(max, e));
    slider.noUiSlider.set([s, e]);
    debouncedRender();
  };

  startInput.addEventListener("input", syncFromInputs);
  endInput.addEventListener("input", syncFromInputs);
  startInput.addEventListener("change", syncFromInputs);
  endInput.addEventListener("change", syncFromInputs);
}

// スライダー初期化
createSlider("numSlider", 0, 145, [0, 145], "numRangeLabel", "numStartInput", "numEndInput");
createSlider("ageSlider", 17, 50, [17, 50], "ageRangeLabel", "ageStartInput", "ageEndInput");
createSlider("draftSlider", 2010, 2026, [2010, 2026], "draftRangeLabel", "draftStartInput", "draftEndInput");

// オートコンプリート
const nameInput = document.getElementById("nameSearch");
const autoList = document.getElementById("autocomplete-list");

nameInput.addEventListener("input", () => {
  const val = nameInput.value.trim();
  autoList.innerHTML = "";

  if (val.length >= 1) {
    const list = collectPlayers()
      .filter(p => p.name.includes(val))
      .slice(0, 10);

    list.forEach(p => {
      const div = document.createElement("div");
      div.textContent = `${p.name} (${displayNumber(p.number)})`;
      div.addEventListener("click", () => {
        nameInput.value = p.name;
        autoList.innerHTML = "";
        renderPlayers(); // 即反映
      });
      autoList.appendChild(div);
    });
  }

  debouncedRender();
});

document.addEventListener("click", e => {
  if (e.target !== nameInput && !autoList.contains(e.target)) {
    autoList.innerHTML = "";
  }
});

// renderPlayers 関数（変更なし）
function renderPlayers() {
  let arr = collectPlayers();

  const pos = document.getElementById("positionFilter").value;
  if (pos) arr = arr.filter(p => p.position === pos);

  const name = nameInput.value.trim();
  if (name) arr = arr.filter(p => p.name.includes(name));

  const numS = parseInt(document.getElementById("numStartInput").value) || 0;
  const numE = parseInt(document.getElementById("numEndInput").value) || 145;
  arr = arr.filter(p => p.number >= numS && p.number <= numE);

  const ageS = parseInt(document.getElementById("ageStartInput").value) || 17;
  const ageE = parseInt(document.getElementById("ageEndInput").value) || 50;
  arr = arr.filter(p => {
    const age = p.ref_year - p.birth_year;
    return age >= ageS && age <= ageE;
  });

  const draftS = parseInt(document.getElementById("draftStartInput").value) || 2010;
  const draftE = parseInt(document.getElementById("draftEndInput").value) || 2026;
  arr = arr.filter(p => p.draft >= draftS && p.draft <= draftE);

  const sort = document.getElementById("sortSelect").value;
  arr.sort((a, b) => {
    const ageA = a.ref_year - a.birth_year;
    const ageB = b.ref_year - b.birth_year;
    switch (sort) {
      case "number_asc": return a.number - b.number;
      case "number_desc": return b.number - a.number;
      case "age_asc": return ageA - ageB;
      case "age_desc": return ageB - ageA;
      case "draft_asc": return a.draft - b.draft;
      case "draft_desc": return b.draft - a.draft;
      case "name_asc": return a.name.localeCompare(b.name, "ja");
      case "name_desc": return b.name.localeCompare(a.name, "ja");
      default: return 0;
    }
  });

  const grid = document.getElementById("playerGrid");
  grid.innerHTML = "";

  if (arr.length === 0) {
    grid.innerHTML = '<p style="text-align:center; grid-column:1/-1; padding:60px 20px;">該当する選手が見つかりませんでした</p>';
    return;
  }

  arr.forEach(p => {
    const age = p.ref_year - p.birth_year;
    const card = document.createElement("div");
    card.className = "player-card";
    card.innerHTML = `
      <div class="player-photo"><img src="${p.photo}" alt="${p.name}"></div>
      <div class="player-info">
        <div class="top">
          <span>${displayNumber(p.number)}</span>
          <span class="position position-${p.position}">${p.position}</span>
        </div>
        <div class="middle"><a href="${p.link}">${p.name}</a></div>
        <div class="bottom">
          <span>ドラフト ${p.draft}</span>
          <span>${age}歳 (${p.ref_year}年基準)</span>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

// 初期化
const yearSelect = document.getElementById("yearSelect");
for (let y = 2026; y >= 2015; y--) {
  const opt = document.createElement("option");
  opt.value = y;
  opt.textContent = y + "年";
  if (y === 2026) opt.selected = true; // デフォルト2026のみ選択
  yearSelect.appendChild(opt);
}

["yearSelect", "positionFilter", "sortSelect"].forEach(id => {
  document.getElementById(id).addEventListener("change", renderPlayers);
});

// 初回描画
renderPlayers();
</script>
</body>
</html>
